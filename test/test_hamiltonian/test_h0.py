from unittest import TestCase

import torch
from xtbml.adjlist import AdjacencyList
from xtbml.basis.type import get_cutoff
from xtbml.constants import FLOAT64
from xtbml.cutoff import get_lattice_points
from xtbml.data.covrad import covalent_rad_d3
from xtbml.exlibs.tbmalt import Geometry
from xtbml.ncoord.ncoord import get_coordination_number, exp_count
from xtbml.param.gfn1 import GFN1_XTB as par
from xtbml.utils import symbol2number
from xtbml.xtb.calculator import Calculator

from .test_h0_data import SampleInfo, data


class TestH0(TestCase):
    """Testing the building of the Hamiltonian matrix."""

    @classmethod
    def setUpClass(cls):
        print(cls.__name__)

    def setUp(self):
        # define some tolerances
        self.atol = 1e-05
        self.rtol = 1e-05
        self.cn_cutoff = 30.0

    def base_test(self, sample: SampleInfo, ref: torch.Tensor) -> None:
        atomic_numbers = symbol2number(sample["elements"])
        mol = Geometry(atomic_numbers, sample["xyz"])

        # TODO: extend geometry object with mol.lattice and mol.periodic
        mol_periodic = [False]
        mol_lattice = None

        # setup calculator
        calc = Calculator(mol, par)

        # prepate cutoffs and lattice
        cutoff = get_cutoff(calc.basis)
        trans = get_lattice_points(mol_periodic, mol_lattice, cutoff)
        adjlist = AdjacencyList(mol, trans, cutoff)

        # build hamiltonian
        h, _ = calc.hamiltonian.build(calc.basis, adjlist, None)

        self.check_hamiltonian(h, ref)

    def base_test_cn(
        self, sample: SampleInfo, ref: torch.Tensor, dtype=FLOAT64
    ) -> None:
        atomic_numbers = symbol2number(sample["elements"])
        mol = Geometry(atomic_numbers, sample["xyz"].type(dtype))

        # TODO: extend geometry object with mol.lattice and mol.periodic
        mol_periodic = [False]
        mol_lattice = None

        # setup calculator
        calc = Calculator(mol, par)

        # prepate cutoffs and lattice
        trans = get_lattice_points(mol_periodic, mol_lattice, self.cn_cutoff)
        rcov = covalent_rad_d3
        cn = get_coordination_number(mol, rcov, exp_count)

        cutoff = get_cutoff(calc.basis)
        trans = get_lattice_points(mol_periodic, mol_lattice, cutoff)
        adjlist = AdjacencyList(mol, trans, cutoff)

        # build hamiltonian
        h, _ = calc.hamiltonian.build(calc.basis, adjlist, cn)

        self.check_hamiltonian(h, ref)

    def check_hamiltonian(self, hamiltonian: torch.Tensor, ref: torch.Tensor) -> None:
        size = hamiltonian.size(dim=0)
        for i in range(size):
            for j in range(size):
                diff = hamiltonian[i, j] - ref[i, j]
                self.assertTrue(
                    diff < self.rtol,
                    msg=f"Hamiltonian does not match reference.\nh[{i}, {j}] = {hamiltonian[i, j]} and ref[{i}, {j}] = {ref[i, j]} -> diff = {diff}",
                )

    ##############
    #### GFN1 ####
    ##############

    def test_hamiltonian_h2_gfn1(self) -> None:
        """
        Compare against reference calculated with tblite-int: fpm run -- H H 0,0,1.4050586229538 --bohr --hamiltonian --method gfn1
        """

        nao = 4
        ref_hamiltonian = torch.tensor(
            [
                -4.0142947439732e-01,
                -2.0462585990502e-10,
                -4.7765681941464e-01,
                -3.6871459395399e-02,
                -2.0462545918772e-10,
                -7.9815929839999e-02,
                -3.6871459395399e-02,
                -2.3348769479620e-02,
                -4.7765681941464e-01,
                -3.6871459395399e-02,
                -4.0142947439732e-01,
                -2.0462585990502e-10,
                -3.6871459395399e-02,
                -2.3348769479620e-02,
                -2.0462545918772e-10,
                -7.9815929839999e-02,
            ]
        ).reshape(nao, nao)

        self.base_test(data["MB16_43_H2"], ref_hamiltonian)

    def test_hamiltonian_h2_gfn1_cn(self) -> None:
        """
        Compare against reference calculated with tblite-int: fpm run -- H H 0,0,1.4050586229538 --bohr --hamiltonian --method gfn1 --cn 0.91396028097949444,0.91396028097949444
        """

        nao = 4
        ref_hamiltonian = torch.tensor(
            [
                -4.0363081796860e-01,
                -2.0574797935551e-10,
                -4.8027617557995e-01,
                -3.7073653691734e-02,
                -2.0574757644077e-10,
                -8.0253621377978e-02,
                -3.7073653691734e-02,
                -2.3476808567105e-02,
                -4.8027617557995e-01,
                -3.7073653691734e-02,
                -4.0363081796860e-01,
                -2.0574797935551e-10,
                -3.7073653691734e-02,
                -2.3476808567105e-02,
                -2.0574757644077e-10,
                -8.0253621377978e-02,
            ]
        ).reshape(nao, nao)

        self.base_test_cn(data["MB16_43_H2"], ref_hamiltonian)

    def test_hamiltonian_lih_gfn1(self) -> None:
        """
        Compare against reference calculated with tblite-int: fpm run -- Li H 0,0,3.0159348779447 --bohr --hamiltonian --method gfn1
        """

        nao = 6
        ref_hamiltonian = torch.tensor(
            [
                -0.26717144,
                0.00000000,
                0.00000000,
                0.00000000,
                -0.23812757,
                0.07861062,
                0.00000000,
                -0.16938781,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                -0.16938781,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                -0.16938781,
                -0.29755322,
                0.02607809,
                -0.23812757,
                0.00000000,
                0.00000000,
                -0.29755322,
                -0.40142947,
                -0.00000000,
                0.07861062,
                0.00000000,
                0.00000000,
                0.02607809,
                -0.00000000,
                -0.07981593,
            ]
        ).reshape(nao, nao)

        self.base_test(data["MB16_43_LiH"], ref_hamiltonian)

    def test_hamiltonian_hli_gfn1(self) -> None:
        """
        Compare against reference calculated with tblite-int: fpm run -- H Li 0,0,3.0159348779447 --bohr --hamiltonian --method gfn1
        """

        nao = 6
        ref_hamiltonian = torch.tensor(
            [
                -4.0142947439732e-01,
                -2.0462585990502e-10,
                -2.3812756752261e-01,
                0.0000000000000e00,
                0.0000000000000e00,
                2.9755321938900e-01,
                -2.0462545918772e-10,
                -7.9815929839999e-02,
                7.8610622058418e-02,
                0.0000000000000e00,
                0.0000000000000e00,
                -2.6078089928320e-02,
                -2.3812756752261e-01,
                7.8610622058418e-02,
                -2.6717144264010e-01,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                -1.6938781290214e-01,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                -1.6938781290214e-01,
                0.0000000000000e00,
                2.9755321938900e-01,
                -2.6078089928320e-02,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                -1.6938781290214e-01,
            ]
        ).reshape(nao, nao)

        self.base_test(data["MB16_43_HLi"], ref_hamiltonian)

    def test_hamiltonian_s2_gfn1(self) -> None:
        """
        Compare against reference calculated with tblite-int: fpm run -- S S 0,0,3.60562542949258 --bohr --hamiltonian --method gfn1
        """

        nao = 18
        ref_hamiltonian = torch.tensor(
            [
                -0.87533262100113585,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                -0.12653141465693216,
                0.0000000000000000,
                0.0000000000000000,
                0.26292482457531474,
                -0.19677526324277286,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                -0.44540680225229817,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                -0.11118318193088698,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.10787512213671338,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                -0.44540680225229817,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                -0.11118318193088698,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.10787512213671338,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                -0.44540680225229817,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                -0.26292482457531474,
                0.0000000000000000,
                0.0000000000000000,
                0.29712055927334230,
                -0.13479336864339173,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                -6.2887684573170663e-002,
                0.0000000000000000,
                0.0000000000000000,
                -3.0232667719934971e-018,
                0.0000000000000000,
                -0.19677526324277292,
                0.0000000000000000,
                0.0000000000000000,
                0.13479336864339175,
                -2.6260625616894233e-002,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                -6.2887684573170691e-002,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                -0.10787512213671338,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                4.0045404036755439e-002,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                -6.2887684573170691e-002,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                -0.10787512213671338,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                4.0045404036755439e-002,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                -3.0232667719934971e-018,
                0.0000000000000000,
                0.0000000000000000,
                -6.2887684573170649e-002,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                -1.2302723340998540e-002,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                -6.2887684573170691e-002,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                -1.2302723340998538e-002,
                -0.12653141465693216,
                0.0000000000000000,
                0.0000000000000000,
                -0.26292482457531474,
                -0.19677526324277292,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                -0.87533262100113585,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                -0.11118318193088698,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                -0.10787512213671338,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                -0.44540680225229817,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                -0.11118318193088698,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                -0.10787512213671338,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                -0.44540680225229817,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.26292482457531474,
                0.0000000000000000,
                0.0000000000000000,
                0.29712055927334230,
                0.13479336864339175,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                -0.44540680225229817,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                -0.19677526324277286,
                0.0000000000000000,
                0.0000000000000000,
                -0.13479336864339173,
                -2.6260625616894233e-002,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                -6.2887684573170663e-002,
                0.0000000000000000,
                0.0000000000000000,
                -3.0232667719934971e-018,
                0.0000000000000000,
                0.0000000000000000,
                0.10787512213671338,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                4.0045404036755439e-002,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                -6.2887684573170691e-002,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.10787512213671338,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                4.0045404036755439e-002,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                -6.2887684573170691e-002,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                -1.2302723340998540e-002,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                -3.0232667719934971e-018,
                0.0000000000000000,
                0.0000000000000000,
                -6.2887684573170649e-002,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                -1.2302723340998538e-002,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                0.0000000000000000,
                -6.2887684573170691e-002,
            ]
        ).reshape(nao, nao)

        self.base_test(data["MB16_43_S2"], ref_hamiltonian)

    def test_hamiltonian_sih4_gfn1(self) -> None:
        """
        Compare against reference calculated with tblite
        """
        # tblite: with "use dftd3_ncoord, only: get_coordination_number"

        nao = 17
        ref_hamiltonian = torch.tensor(
            [
                -5.3309039475389e-01,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                -3.1565172387028e-01,
                8.9829370082382e-02,
                -3.1565172387028e-01,
                8.9829370082382e-02,
                -3.1565172387028e-01,
                8.9829370082382e-02,
                -3.1565172387028e-01,
                8.9829370082382e-02,
                0.0000000000000e00,
                -2.7772702440905e-01,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                -1.9122600496763e-01,
                -2.8405387389105e-02,
                1.9122600496763e-01,
                2.8405387389105e-02,
                -1.9122600496763e-01,
                -2.8405387389105e-02,
                1.9122600496763e-01,
                2.8405387389105e-02,
                0.0000000000000e00,
                0.0000000000000e00,
                -2.7772702440905e-01,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                -1.9122600496763e-01,
                -2.8405387389105e-02,
                1.9122600496763e-01,
                2.8405387389105e-02,
                1.9122600496763e-01,
                2.8405387389105e-02,
                -1.9122600496763e-01,
                -2.8405387389105e-02,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                -2.7772702440905e-01,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                1.9122600496763e-01,
                2.8405387389105e-02,
                1.9122600496763e-01,
                2.8405387389105e-02,
                -1.9122600496763e-01,
                -2.8405387389105e-02,
                -1.9122600496763e-01,
                -2.8405387389105e-02,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                -9.2171456731538e-02,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                -9.2171456731538e-02,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                1.5595811530253e-01,
                3.1848482281737e-02,
                -1.5595811530253e-01,
                -3.1848482281737e-02,
                -1.5595811530253e-01,
                -3.1848482281737e-02,
                1.5595811530253e-01,
                3.1848482281737e-02,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                -9.2171456731538e-02,
                0.0000000000000e00,
                0.0000000000000e00,
                1.5595811530253e-01,
                3.1848482281737e-02,
                -1.5595811530253e-01,
                -3.1848482281737e-02,
                1.5595811530253e-01,
                3.1848482281737e-02,
                -1.5595811530253e-01,
                -3.1848482281737e-02,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                -9.2171456731538e-02,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                -9.2171456731538e-02,
                -1.5595811530253e-01,
                -3.1848482281737e-02,
                -1.5595811530253e-01,
                -3.1848482281737e-02,
                1.5595811530253e-01,
                3.1848482281737e-02,
                1.5595811530253e-01,
                3.1848482281737e-02,
                -3.1565172387028e-01,
                -1.9122600496763e-01,
                -1.9122600496763e-01,
                1.9122600496763e-01,
                0.0000000000000e00,
                1.5595811530253e-01,
                1.5595811530253e-01,
                0.0000000000000e00,
                -1.5595811530253e-01,
                -4.0142947439732e-01,
                -2.0462585990502e-10,
                -4.7320589254670e-02,
                5.4154701778621e-02,
                -4.7320589254670e-02,
                5.4154701778621e-02,
                -4.7320589254670e-02,
                5.4154701778621e-02,
                8.9829370082382e-02,
                -2.8405387389105e-02,
                -2.8405387389105e-02,
                2.8405387389105e-02,
                0.0000000000000e00,
                3.1848482281737e-02,
                3.1848482281737e-02,
                0.0000000000000e00,
                -3.1848482281737e-02,
                -2.0462545918772e-10,
                -7.9815929839999e-02,
                5.4154701778621e-02,
                -6.1645802522183e-03,
                5.4154701778621e-02,
                -6.1645802522183e-03,
                5.4154701778621e-02,
                -6.1645802522183e-03,
                -3.1565172387028e-01,
                1.9122600496763e-01,
                1.9122600496763e-01,
                1.9122600496763e-01,
                0.0000000000000e00,
                -1.5595811530253e-01,
                -1.5595811530253e-01,
                0.0000000000000e00,
                -1.5595811530253e-01,
                -4.7320589254670e-02,
                5.4154701778621e-02,
                -4.0142947439732e-01,
                -2.0462585990502e-10,
                -4.7320589254670e-02,
                5.4154701778621e-02,
                -4.7320589254670e-02,
                5.4154701778621e-02,
                8.9829370082382e-02,
                2.8405387389105e-02,
                2.8405387389105e-02,
                2.8405387389105e-02,
                0.0000000000000e00,
                -3.1848482281737e-02,
                -3.1848482281737e-02,
                0.0000000000000e00,
                -3.1848482281737e-02,
                5.4154701778621e-02,
                -6.1645802522183e-03,
                -2.0462545918772e-10,
                -7.9815929839999e-02,
                5.4154701778621e-02,
                -6.1645802522183e-03,
                5.4154701778621e-02,
                -6.1645802522183e-03,
                -3.1565172387028e-01,
                -1.9122600496763e-01,
                1.9122600496763e-01,
                -1.9122600496763e-01,
                0.0000000000000e00,
                -1.5595811530253e-01,
                1.5595811530253e-01,
                0.0000000000000e00,
                1.5595811530253e-01,
                -4.7320589254670e-02,
                5.4154701778621e-02,
                -4.7320589254670e-02,
                5.4154701778621e-02,
                -4.0142947439732e-01,
                -2.0462585990502e-10,
                -4.7320589254670e-02,
                5.4154701778621e-02,
                8.9829370082382e-02,
                -2.8405387389105e-02,
                2.8405387389105e-02,
                -2.8405387389105e-02,
                0.0000000000000e00,
                -3.1848482281737e-02,
                3.1848482281737e-02,
                0.0000000000000e00,
                3.1848482281737e-02,
                5.4154701778621e-02,
                -6.1645802522183e-03,
                5.4154701778621e-02,
                -6.1645802522183e-03,
                -2.0462545918772e-10,
                -7.9815929839999e-02,
                5.4154701778621e-02,
                -6.1645802522183e-03,
                -3.1565172387028e-01,
                1.9122600496763e-01,
                -1.9122600496763e-01,
                -1.9122600496763e-01,
                0.0000000000000e00,
                1.5595811530253e-01,
                -1.5595811530253e-01,
                0.0000000000000e00,
                1.5595811530253e-01,
                -4.7320589254670e-02,
                5.4154701778621e-02,
                -4.7320589254670e-02,
                5.4154701778621e-02,
                -4.7320589254670e-02,
                5.4154701778621e-02,
                -4.0142947439732e-01,
                -2.0462585990502e-10,
                8.9829370082382e-02,
                2.8405387389105e-02,
                -2.8405387389105e-02,
                -2.8405387389105e-02,
                0.0000000000000e00,
                3.1848482281737e-02,
                -3.1848482281737e-02,
                0.0000000000000e00,
                3.1848482281737e-02,
                5.4154701778621e-02,
                -6.1645802522183e-03,
                5.4154701778621e-02,
                -6.1645802522183e-03,
                5.4154701778621e-02,
                -6.1645802522183e-03,
                -2.0462545918772e-10,
                -7.9815929839999e-02,
            ]
        ).reshape(nao, nao)

        self.base_test(data["MB16_43_SiH4"], ref_hamiltonian)

    def test_hamiltonian_sih4_gfn1_cn(self) -> None:
        """
        Compare against reference calculated with tblite
        """
        # tblite: with "use dftd3_ncoord, only: get_coordination_number"

        nao = 17
        ref_hamiltonian = torch.tensor(
            [
                -5.4553345097654e-01,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                -3.2064589424783e-01,
                9.1721330159347e-02,
                -3.2064589424783e-01,
                9.1721330159347e-02,
                -3.2064589424783e-01,
                9.1721330159347e-02,
                -3.2064589424783e-01,
                9.1721330159347e-02,
                0.0000000000000e00,
                -2.7448576081353e-01,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                -1.9097300361861e-01,
                -2.8184887565241e-02,
                1.9097300361861e-01,
                2.8184887565241e-02,
                -1.9097300361861e-01,
                -2.8184887565241e-02,
                1.9097300361861e-01,
                2.8184887565241e-02,
                0.0000000000000e00,
                0.0000000000000e00,
                -2.7448576081353e-01,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                -1.9097300361861e-01,
                -2.8184887565241e-02,
                1.9097300361861e-01,
                2.8184887565241e-02,
                1.9097300361861e-01,
                2.8184887565241e-02,
                -1.9097300361861e-01,
                -2.8184887565241e-02,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                -2.7448576081353e-01,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                1.9097300361861e-01,
                2.8184887565241e-02,
                1.9097300361861e-01,
                2.8184887565241e-02,
                -1.9097300361861e-01,
                -2.8184887565241e-02,
                -1.9097300361861e-01,
                -2.8184887565241e-02,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                -9.0378617234520e-02,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                -9.0378617234520e-02,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                1.5613185119756e-01,
                3.1602741943440e-02,
                -1.5613185119756e-01,
                -3.1602741943440e-02,
                -1.5613185119756e-01,
                -3.1602741943440e-02,
                1.5613185119756e-01,
                3.1602741943440e-02,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                -9.0378617234520e-02,
                0.0000000000000e00,
                0.0000000000000e00,
                1.5613185119756e-01,
                3.1602741943440e-02,
                -1.5613185119756e-01,
                -3.1602741943440e-02,
                1.5613185119756e-01,
                3.1602741943440e-02,
                -1.5613185119756e-01,
                -3.1602741943440e-02,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                -9.0378617234520e-02,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                0.0000000000000e00,
                -9.0378617234520e-02,
                -1.5613185119756e-01,
                -3.1602741943440e-02,
                -1.5613185119756e-01,
                -3.1602741943440e-02,
                1.5613185119756e-01,
                3.1602741943440e-02,
                1.5613185119756e-01,
                3.1602741943440e-02,
                -3.2064589424783e-01,
                -1.9097300361861e-01,
                -1.9097300361861e-01,
                1.9097300361861e-01,
                0.0000000000000e00,
                1.5613185119756e-01,
                1.5613185119756e-01,
                0.0000000000000e00,
                -1.5613185119756e-01,
                -4.0377218075679e-01,
                -2.0582003804561e-10,
                -4.7596747963612e-02,
                5.4470743754468e-02,
                -4.7596747963612e-02,
                5.4470743754468e-02,
                -4.7596747963612e-02,
                5.4470743754468e-02,
                9.1721330159347e-02,
                -2.8184887565241e-02,
                -2.8184887565241e-02,
                2.8184887565241e-02,
                0.0000000000000e00,
                3.1602741943440e-02,
                3.1602741943440e-02,
                0.0000000000000e00,
                -3.1602741943440e-02,
                -2.0581963498976e-10,
                -8.0281728438132e-02,
                5.4470743754468e-02,
                -6.2005561889181e-03,
                5.4470743754468e-02,
                -6.2005561889181e-03,
                5.4470743754468e-02,
                -6.2005561889181e-03,
                -3.2064589424783e-01,
                1.9097300361861e-01,
                1.9097300361861e-01,
                1.9097300361861e-01,
                0.0000000000000e00,
                -1.5613185119756e-01,
                -1.5613185119756e-01,
                0.0000000000000e00,
                -1.5613185119756e-01,
                -4.7596747963612e-02,
                5.4470743754468e-02,
                -4.0377218075679e-01,
                -2.0582003804561e-10,
                -4.7596747963612e-02,
                5.4470743754468e-02,
                -4.7596747963612e-02,
                5.4470743754468e-02,
                9.1721330159347e-02,
                2.8184887565241e-02,
                2.8184887565241e-02,
                2.8184887565241e-02,
                0.0000000000000e00,
                -3.1602741943440e-02,
                -3.1602741943440e-02,
                0.0000000000000e00,
                -3.1602741943440e-02,
                5.4470743754468e-02,
                -6.2005561889181e-03,
                -2.0581963498976e-10,
                -8.0281728438132e-02,
                5.4470743754468e-02,
                -6.2005561889181e-03,
                5.4470743754468e-02,
                -6.2005561889181e-03,
                -3.2064589424783e-01,
                -1.9097300361861e-01,
                1.9097300361861e-01,
                -1.9097300361861e-01,
                0.0000000000000e00,
                -1.5613185119756e-01,
                1.5613185119756e-01,
                0.0000000000000e00,
                1.5613185119756e-01,
                -4.7596747963612e-02,
                5.4470743754468e-02,
                -4.7596747963612e-02,
                5.4470743754468e-02,
                -4.0377218075679e-01,
                -2.0582003804561e-10,
                -4.7596747963612e-02,
                5.4470743754468e-02,
                9.1721330159347e-02,
                -2.8184887565241e-02,
                2.8184887565241e-02,
                -2.8184887565241e-02,
                0.0000000000000e00,
                -3.1602741943440e-02,
                3.1602741943440e-02,
                0.0000000000000e00,
                3.1602741943440e-02,
                5.4470743754468e-02,
                -6.2005561889181e-03,
                5.4470743754468e-02,
                -6.2005561889181e-03,
                -2.0581963498976e-10,
                -8.0281728438132e-02,
                5.4470743754468e-02,
                -6.2005561889181e-03,
                -3.2064589424783e-01,
                1.9097300361861e-01,
                -1.9097300361861e-01,
                -1.9097300361861e-01,
                0.0000000000000e00,
                1.5613185119756e-01,
                -1.5613185119756e-01,
                0.0000000000000e00,
                1.5613185119756e-01,
                -4.7596747963612e-02,
                5.4470743754468e-02,
                -4.7596747963612e-02,
                5.4470743754468e-02,
                -4.7596747963612e-02,
                5.4470743754468e-02,
                -4.0377218075679e-01,
                -2.0582003804561e-10,
                9.1721330159347e-02,
                2.8184887565241e-02,
                -2.8184887565241e-02,
                -2.8184887565241e-02,
                0.0000000000000e00,
                3.1602741943440e-02,
                -3.1602741943440e-02,
                0.0000000000000e00,
                3.1602741943440e-02,
                5.4470743754468e-02,
                -6.2005561889181e-03,
                5.4470743754468e-02,
                -6.2005561889181e-03,
                5.4470743754468e-02,
                -6.2005561889181e-03,
                -2.0581963498976e-10,
                -8.0281728438132e-02,
            ]
        ).reshape(nao, nao)

        self.base_test_cn(data["MB16_43_SiH4"], ref_hamiltonian)

    ##############
    #### GFN2 ####
    ##############

    # def test_hamiltonian_h2_gfn2(self) -> None:
    #     nao = 2
    #     ref_hamiltonian = torch.tensor([
    #         -3.91986875628795E-1, -4.69784163992013E-1,
    #         -4.69784163992013E-1, -3.91986875628795E-1
    #     ]).reshape(nao, nao)

    #     self.base_test(data["MB16_43_H2"], ref_hamiltonian)

    # def test_hamiltonian_lih_gfn2(self) -> None:
    #     nao = 5
    #     ref_hamiltonian = torch.tensor([
    #         -1.85652586923456E-1, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, -2.04060196214555E-1, 0.00000000000000E+0,
    #         -7.93540972812401E-2, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         -7.93540972812401E-2, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         -7.93540972812401E-2, -2.64332062163992E-1, -2.04060196214555E-1,
    #         0.00000000000000E+0, 0.00000000000000E+0, -2.64332062163992E-1,
    #         -3.91761139212137E-1
    #     ]).reshape(nao, nao)

    #     self.base_test(data["MB16_43_LiH"], ref_hamiltonian)

    # def test_hamiltonian_s2_gfn2(self) -> None:
    #     nao = 18
    #     ref_hamiltonian = torch.tensor([
    #         -7.35145147501899E-1, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         -1.92782969898654E-1, 0.00000000000000E+0, 0.00000000000000E+0,
    #         2.36427116435023E-1, -2.05951870741313E-1, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, -4.17765757158496E-1, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, -9.33756556185781E-2, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 1.20176381592757E-1,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, -4.17765757158496E-1,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, -9.33756556185781E-2,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         1.20176381592757E-1, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         -4.17765757158496E-1, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         -2.36427116435023E-1, 0.00000000000000E+0, 0.00000000000000E+0,
    #         2.58607478516679E-1, -1.23733824351312E-1, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, -2.27200169863736E-2, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         -2.05951870741313E-1, 0.00000000000000E+0, 0.00000000000000E+0,
    #         1.23733824351312E-1, -9.40352474745915E-3, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, -2.27200169863736E-2,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, -1.20176381592757E-1, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 2.45142819855746E-2,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         -2.27200169863736E-2, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, -1.20176381592757E-1,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         2.45142819855746E-2, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, -2.27200169863736E-2, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, -1.00344447956584E-2, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, -2.27200169863736E-2,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, -1.00344447956584E-2,
    #         -1.92782969898654E-1, 0.00000000000000E+0, 0.00000000000000E+0,
    #         -2.36427116435023E-1, -2.05951870741313E-1, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         -7.35145147501899E-1, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, -9.33756556185781E-2, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, -1.20176381592757E-1,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, -4.17765757158496E-1, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, -9.33756556185781E-2,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         -1.20176381592757E-1, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, -4.17765757158496E-1,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         2.36427116435023E-1, 0.00000000000000E+0, 0.00000000000000E+0,
    #         2.58607478516679E-1, 1.23733824351312E-1, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         -4.17765757158496E-1, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         -2.05951870741313E-1, 0.00000000000000E+0, 0.00000000000000E+0,
    #         -1.23733824351312E-1, -9.40352474745915E-3, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, -2.27200169863736E-2, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 1.20176381592757E-1, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 2.45142819855746E-2,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, -2.27200169863736E-2,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 1.20176381592757E-1,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         2.45142819855746E-2, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         -2.27200169863736E-2, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, -1.00344447956584E-2, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, -2.27200169863736E-2, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, -1.00344447956584E-2,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, -2.27200169863736E-2
    #     ]).reshape(nao, nao)

    #     self.base_test(data["MB16_43_S2"], ref_hamiltonian)

    # def test_hamiltonian_sih4_gfn2(self) -> None:
    #     nao = 13
    #     ref_hamiltonian = torch.tensor([
    #         -5.52420992289823E-1, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         -3.36004309624475E-1, -3.36004309624475E-1, -3.36004309624475E-1,
    #         -3.36004309624475E-1, 0.00000000000000E+0, -2.35769689453471E-1,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, -1.53874693770200E-1, 1.53874693770200E-1,
    #         -1.53874693770200E-1, 1.53874693770200E-1, 0.00000000000000E+0,
    #         0.00000000000000E+0, -2.35769689453471E-1, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, -1.53874693770200E-1,
    #         1.53874693770200E-1, 1.53874693770200E-1, -1.53874693770200E-1,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         -2.35769689453471E-1, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         1.53874693770200E-1, 1.53874693770200E-1, -1.53874693770200E-1,
    #         -1.53874693770200E-1, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, -4.13801957898401E-2,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, -4.13801957898401E-2, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 1.23912378305726E-1,
    #         -1.23912378305726E-1, -1.23912378305726E-1, 1.23912378305726E-1,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         -4.13801957898401E-2, 0.00000000000000E+0, 0.00000000000000E+0,
    #         1.23912378305726E-1, -1.23912378305726E-1, 1.23912378305726E-1,
    #         -1.23912378305726E-1, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, -4.13801957898401E-2,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, 0.00000000000000E+0, 0.00000000000000E+0,
    #         0.00000000000000E+0, -4.13801957898401E-2, -1.23912378305726E-1,
    #         -1.23912378305726E-1, 1.23912378305726E-1, 1.23912378305726E-1,
    #         -3.36004309624475E-1, -1.53874693770200E-1, -1.53874693770200E-1,
    #         1.53874693770200E-1, 0.00000000000000E+0, 1.23912378305726E-1,
    #         1.23912378305726E-1, 0.00000000000000E+0, -1.23912378305726E-1,
    #         -3.91823578951118E-1, -4.31486716382575E-2, -4.31486716382575E-2,
    #         -4.31486716382575E-2, -3.36004309624475E-1, 1.53874693770200E-1,
    #         1.53874693770200E-1, 1.53874693770200E-1, 0.00000000000000E+0,
    #         -1.23912378305726E-1, -1.23912378305726E-1, 0.00000000000000E+0,
    #         -1.23912378305726E-1, -4.31486716382575E-2, -3.91823578951118E-1,
    #         -4.31486716382575E-2, -4.31486716382575E-2, -3.36004309624475E-1,
    #         -1.53874693770200E-1, 1.53874693770200E-1, -1.53874693770200E-1,
    #         0.00000000000000E+0, -1.23912378305726E-1, 1.23912378305726E-1,
    #         0.00000000000000E+0, 1.23912378305726E-1, -4.31486716382575E-2,
    #         -4.31486716382575E-2, -3.91823578951118E-1, -4.31486716382575E-2,
    #         -3.36004309624475E-1, 1.53874693770200E-1, -1.53874693770200E-1,
    #         -1.53874693770200E-1, 0.00000000000000E+0, 1.23912378305726E-1,
    #         -1.23912378305726E-1, 0.00000000000000E+0, 1.23912378305726E-1,
    #         -4.31486716382575E-2, -4.31486716382575E-2, -4.31486716382575E-2,
    #         -3.91823578951118E-1
    #     ]).reshape(nao, nao)

    #     self.base_test(data["MB16_43_SiH4"], ref_hamiltonian)
