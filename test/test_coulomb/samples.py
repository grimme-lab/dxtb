# This file is part of dxtb.
#
# SPDX-Identifier: Apache-2.0
# Copyright (C) 2024 Grimme Group
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
"""
Data for testing Coulomb contribution.
"""

from __future__ import annotations

import torch
from tad_mctc.data.molecules import merge_nested_dicts, mols

from dxtb._src.typing import Molecule, Tensor, TypedDict


class Refs(TypedDict):
    """Format of reference records containing GFN1-xTB and GFN2-xTB reference values."""

    q: Tensor
    """Atomic or shell-resolved partial charges for this structure."""

    es2: Tensor
    """Reference values for ES2 (GFN1-xTB)"""

    es3: Tensor
    """Reference values for ES3 (GFN1-xTB)"""

    grad: Tensor
    """Nuclear gradient of ES2 energy."""


class Record(Molecule, Refs):
    """Store for molecular information and reference values"""


refs: dict[str, Refs] = {
    "MB16_43_01": {
        "es2": torch.tensor(0.10952019883948200, dtype=torch.float64),
        "es3": torch.tensor(0.0212785489857197, dtype=torch.float64),
        "q": torch.tensor(
            [
                +7.7334791421890259e-01,
                +1.0762689262628555e-01,
                -3.6699959635734558e-01,
                +4.9283333122730255e-02,
                -1.8333216011524200e-01,
                +2.3330208659172058e-01,
                +6.6183716058731079e-02,
                -5.4394418001174927e-01,
                -2.7026435732841492e-01,
                +2.6661896705627441e-01,
                +2.6272502541542053e-01,
                -7.1531549096107483e-02,
                -3.7330079078674316e-01,
                +3.8458522409200668e-02,
                -5.0585108995437622e-01,
                +5.1767724752426147e-01,
            ],
            dtype=torch.float64,
        ),
        "grad": torch.tensor(
            [
                [
                    +1.2083900639465609e-03,
                    +1.9061942956337726e-03,
                    -9.3184775629406528e-03,
                ],
                [
                    +1.3353236834648988e-03,
                    +3.4601770642340361e-04,
                    -7.7029612343846633e-04,
                ],
                [
                    -1.4735929336890854e-03,
                    -2.4637013340701184e-03,
                    +7.1631727829105547e-03,
                ],
                [
                    -7.0650180704900012e-04,
                    +7.7730556435608807e-04,
                    -2.5300981658677471e-04,
                ],
                [
                    +1.0693974957423638e-03,
                    +1.1007215467951632e-03,
                    -1.6970124155461824e-03,
                ],
                [
                    -6.4639327373616894e-03,
                    -5.3915001232100711e-03,
                    -2.0699724122510252e-03,
                ],
                [
                    +1.5887799637089636e-05,
                    +6.5164307477595044e-04,
                    +3.8082262250701556e-04,
                ],
                [
                    -1.0802467413854898e-02,
                    -5.1113445372175034e-03,
                    +7.6145473705296436e-03,
                ],
                [
                    -2.0628921171750823e-03,
                    -1.6456628917056993e-03,
                    +5.4830775555903336e-03,
                ],
                [
                    +1.1738424847223025e-02,
                    +4.0314346763534485e-03,
                    -4.4432250639396481e-03,
                ],
                [
                    -2.3578783365295702e-03,
                    -3.3979490975295447e-03,
                    +8.0092810296158185e-03,
                ],
                [
                    +2.2139259356298218e-04,
                    +1.4854937531600336e-04,
                    +5.5981099269861731e-05,
                ],
                [
                    -2.8819448775219527e-04,
                    -3.0994283347247809e-03,
                    +8.2907813596309237e-04,
                ],
                [
                    +3.3839532083695652e-05,
                    -1.3583641375621098e-04,
                    -2.1109107905645119e-04,
                ],
                [
                    +7.3568868167777019e-03,
                    +1.1000383693130875e-02,
                    -4.5164793488197087e-03,
                ],
                [
                    +1.1759170009732053e-03,
                    +1.2831727994292255e-03,
                    -6.2563967738074088e-03,
                ],
            ],
            dtype=torch.float64,
        ),
    },
    "MB16_43_02": {
        "es2": torch.tensor(0.16666303125798329, dtype=torch.float64),
        "es3": torch.tensor(0.0155668621882796, dtype=torch.float64),
        "q": torch.tensor(
            [
                +7.3839470744132996e-02,
                -1.6835497319698334e-01,
                -3.4764283895492554e-01,
                -7.0548927783966064e-01,
                +7.7354830503463745e-01,
                +2.3020757734775543e-01,
                +1.0274849832057953e-01,
                +9.4781808555126190e-02,
                +2.4426035583019257e-02,
                +2.3498493432998657e-01,
                -3.1783989071846008e-01,
                +6.6711300611495972e-01,
                -4.7811996936798096e-01,
                +6.5753601491451263e-02,
                +1.0825905203819275e-01,
                -3.5821533203125000e-01,
            ],
            dtype=torch.float64,
        ),
        "grad": torch.tensor(
            [
                [
                    -6.5237465518179478e-05,
                    -5.3043337263488017e-04,
                    -9.3988552226935049e-04,
                ],
                [
                    +1.0965763398933519e-03,
                    -2.2026551389390751e-03,
                    +1.9720100367881608e-03,
                ],
                [
                    -2.1604253079454986e-03,
                    -4.8656086382870747e-03,
                    +3.8235320666296082e-04,
                ],
                [
                    -5.8640540539080643e-03,
                    +3.6796374996311892e-03,
                    -1.3231667569008322e-02,
                ],
                [
                    +4.8283167486293174e-03,
                    +3.8887418313574640e-03,
                    +7.1413708338043148e-03,
                ],
                [
                    -5.7346328703487435e-04,
                    -9.6668259593078350e-03,
                    +6.1269349713357615e-03,
                ],
                [
                    +2.1569583219510841e-04,
                    -1.3963320290368490e-03,
                    +7.7202176021628588e-04,
                ],
                [
                    +9.9223056689727709e-05,
                    +1.2469821350922440e-03,
                    +1.1083248196897771e-03,
                ],
                [
                    +9.2304316238666766e-05,
                    -1.0523026495341580e-04,
                    +6.5758473604732651e-05,
                ],
                [
                    +9.4695189653956242e-03,
                    +2.6765515651474420e-03,
                    +3.6165934740478509e-03,
                ],
                [
                    -1.5103711241976647e-03,
                    +3.1387753789307348e-03,
                    +1.3053978756159019e-03,
                ],
                [
                    -5.3647448939590000e-03,
                    +7.3500978147683887e-05,
                    +2.9657863103124604e-03,
                ],
                [
                    -6.2427248098283379e-03,
                    +8.0850148941583478e-03,
                    -9.1821622898877377e-03,
                ],
                [
                    +8.2409255456209602e-05,
                    -1.9427815856608443e-04,
                    +1.4530475097986620e-04,
                ],
                [
                    +1.2428324488997723e-03,
                    -5.1031836213686482e-04,
                    -2.7633783870751959e-04,
                ],
                [
                    +4.6541439789938412e-03,
                    -3.3175223586030360e-03,
                    -1.9718032931851409e-03,
                ],
            ],
            dtype=torch.float64,
        ),
    },
    "MB16_43_07": {  # shell-resolved charges and gradients
        "es2": torch.tensor(0.12017418620257683, dtype=torch.float64),
        "es3": torch.tensor(0.0, dtype=torch.float64),
        "q": torch.tensor(
            [
                +8.8596022129058838e-01,
                -1.0356724262237549e00,
                +2.3449918627738953e-01,
                -2.1833347156643867e-02,
                +1.0902611017227173e00,
                -7.5428396463394165e-01,
                +4.1274033486843109e-02,
                -9.6002155914902687e-03,
                +5.1767293363809586e-02,
                -1.0523837991058826e-02,
                +5.9433255344629288e-02,
                -3.9489799737930298e-01,
                +1.4450673013925552e-02,
                +1.5787012875080109e-01,
                -4.6440556645393372e-01,
                +4.7812232375144958e-01,
                -1.0143736600875854e00,
                +9.1033732891082764e-01,
                -4.6157899498939514e-01,
                +9.0761981904506683e-02,
                -3.0731001868844032e-02,
                +1.1395587772130966e-01,
                -3.9991357922554016e-01,
                +1.0487200692296028e-02,
                +4.1295102238655090e-01,
                -5.2687402814626694e-02,
                +4.0443599224090576e-01,
                -2.7010707184672356e-02,
                +3.1367531418800354e-01,
                -9.4423663616180420e-01,
                +1.7532956600189209e-01,
                -4.2600473761558533e-01,
                +1.2486056089401245e00,
                -6.4642405509948730e-01,
            ],
            dtype=torch.float64,
        ),
        "grad": torch.tensor(
            [
                [
                    -1.1158689420468295e-04,
                    -9.4325224931291287e-05,
                    -2.4541370290146619e-04,
                ],
                [
                    -1.5719738198544373e-03,
                    -2.3977816668625824e-03,
                    +6.1339193923076688e-03,
                ],
                [
                    -1.6042385761491783e-03,
                    -2.1958082700178493e-03,
                    -1.6747812742226708e-03,
                ],
                [
                    -1.6537822527518407e-05,
                    -3.4268680513403798e-05,
                    +1.7429030254374785e-04,
                ],
                [
                    -7.8448349402138331e-05,
                    -1.0770637122240939e-04,
                    -6.3035093160611531e-05,
                ],
                [
                    -1.0110249312850744e-03,
                    -7.5952175228317324e-04,
                    -6.2001222160320635e-04,
                ],
                [
                    -5.1935617552229425e-03,
                    +2.0076885550501626e-03,
                    -5.2221630134030904e-03,
                ],
                [
                    +1.4239939617592678e-04,
                    +4.8767812091113708e-04,
                    -5.0769013976375045e-03,
                ],
                [
                    -2.9508042967427745e-03,
                    -1.0666291927900759e-03,
                    +9.0580572947990962e-03,
                ],
                [
                    +6.7494834706915106e-04,
                    -6.6684447848499543e-04,
                    -3.9681377819825517e-04,
                ],
                [
                    +3.9727845837011881e-03,
                    -1.7093499042606991e-03,
                    +2.0056409654162499e-03,
                ],
                [
                    -6.1100935167253878e-03,
                    -3.1817757178165471e-03,
                    -9.4534227005632597e-03,
                ],
                [
                    +3.2290957603866004e-03,
                    +1.2229365929369219e-02,
                    -9.7694611225466570e-03,
                ],
                [
                    +5.9137014008744070e-03,
                    -8.2934321277995694e-03,
                    +1.5230600607422946e-02,
                ],
                [
                    +3.1104208074774929e-03,
                    +4.4140682408282681e-03,
                    -4.6279173645474153e-03,
                ],
                [
                    +1.6049196664293624e-03,
                    +1.3686425408238178e-03,
                    +4.5474131062944274e-03,
                ],
            ],
            dtype=torch.float64,
        ),
    },
    "MB16_43_08": {  # shell-resolved charges and gradients
        "es2": torch.tensor(0.11889887832100766, dtype=torch.float64),
        "es3": torch.tensor(0.0, dtype=torch.float64),
        "q": torch.tensor(
            [
                +9.0625989437103271e-01,
                -1.1173082590103149e00,
                +2.7801734209060669e-01,
                -7.8002899885177612e-01,
                +1.1135281324386597e00,
                -6.9829005002975464e-01,
                +2.0394323766231537e-01,
                -5.2990281581878662e-01,
                +4.3821994215250015e-02,
                -1.8674632534384727e-02,
                +4.6599645167589188e-02,
                +4.9759081006050110e-01,
                -2.5044196844100952e-01,
                +4.8329543322324753e-02,
                -2.2655924782156944e-02,
                +4.5033197849988937e-02,
                -2.1156933158636093e-02,
                +3.1247061491012573e-01,
                -9.1558927297592163e-01,
                +1.0639426708221436e00,
                -6.7195236682891846e-01,
                +1.8232247829437256e00,
                -9.2611002922058105e-01,
                +9.7835713624954224e-01,
                -7.8482419252395630e-01,
                -9.4354927539825439e-02,
                -8.7813399732112885e-03,
                -7.0778317749500275e-02,
                -3.3669296652078629e-02,
                +6.7537510395050049e-01,
                -7.0185703039169312e-01,
                +2.1159812808036804e-01,
                -6.0171592235565186e-01,
            ],
            dtype=torch.float64,
        ),
        "grad": torch.tensor(
            [
                [
                    -6.1303949640299630e-04,
                    +5.6997424253391006e-04,
                    -5.9761215514237147e-04,
                ],
                [
                    +7.9447629147067871e-03,
                    +4.8329528663158955e-03,
                    -2.4571229061198276e-03,
                ],
                [
                    -7.8769177629164355e-03,
                    -1.4236560218130242e-03,
                    +1.4062119424323454e-03,
                ],
                [
                    +4.1863463482451485e-03,
                    +3.1399502005168781e-03,
                    -7.6772246436691090e-04,
                ],
                [
                    +1.9745391960928424e-05,
                    -4.8379805376245314e-05,
                    +1.6629973356697525e-04,
                ],
                [
                    -1.4686986097165072e-03,
                    +1.3211106120352666e-03,
                    -2.4216869372706389e-03,
                ],
                [
                    -9.7786453874435176e-05,
                    -2.4248352683219781e-04,
                    +1.6129397594526418e-04,
                ],
                [
                    -8.1112450511949095e-05,
                    +1.5064705311030092e-04,
                    +1.8616245651508536e-04,
                ],
                [
                    -2.8763665590047678e-03,
                    -1.1285940573681399e-02,
                    -3.1867585750163033e-03,
                ],
                [
                    -3.2669189557977115e-03,
                    +4.2727651319202312e-03,
                    +6.9944207551659310e-03,
                ],
                [
                    -3.3363453740409624e-05,
                    +2.7151841302514470e-03,
                    -2.2520863770750590e-04,
                ],
                [
                    +2.9286376619121868e-04,
                    -1.1782227791104893e-03,
                    +5.0858797541698877e-03,
                ],
                [
                    -2.2155595038014293e-04,
                    -8.0520266415374272e-04,
                    -4.4325245991296100e-04,
                ],
                [
                    +2.7991341328202331e-04,
                    -2.1115535160637008e-04,
                    -3.7315590376107066e-04,
                ],
                [
                    +6.1179573417370354e-06,
                    -7.8912541186972602e-05,
                    +1.9575278939680505e-04,
                ],
                [
                    +3.8060099006175102e-03,
                    -1.7286309729234747e-03,
                    -3.7235013678946815e-03,
                ],
            ],
            dtype=torch.float64,
        ),
    },
    "LiH": {  # shell-resolved charges and gradients
        "es2": torch.tensor(0.0, dtype=torch.float64),
        "es3": torch.tensor(0.0, dtype=torch.float64),
        "q": torch.tensor(
            [
                +6.1767599778670401e-01,
                -3.4157592431816863e-01,
                -2.7789560584675121e-01,
                +1.7955323782162661e-03,
            ],
            dtype=torch.float64,
        ),
        "grad": torch.tensor(
            [
                [
                    +0.0000000000000000e00,
                    +0.0000000000000000e00,
                    -2.6068304143608591e-03,
                ],
                [
                    +0.0000000000000000e00,
                    +0.0000000000000000e00,
                    +2.6068304143608591e-03,
                ],
            ],
            dtype=torch.float64,
        ),
    },
    "SiH4": {  # shell-resolved charges and gradients
        "es2": torch.tensor(4.3803610149365790e-003),
        "es3": torch.tensor(-2.9771152185276151e-005),
        "q": torch.tensor(
            [
                +6.5663937010219886e-01,
                +3.5838834166483924e-02,
                -4.1737062303296402e-01,
                -7.1859260070046282e-02,
                +3.0823647611152977e-03,
                -7.1859260070046060e-02,
                +3.0823647611153662e-03,
                -7.1859260070045838e-02,
                +3.0823647611152409e-03,
                -7.1859260070045838e-02,
                +3.0823647611152799e-03,
            ],
            dtype=torch.float64,
        ),
        "grad": torch.tensor(
            [
                [
                    -3.0730355326386016e-18,
                    -2.3479753297889205e-18,
                    +4.6993387913668583e-18,
                ],
                [
                    +3.8594593382759371e-04,
                    +3.8594593382759365e-04,
                    -3.8594593382759382e-04,
                ],
                [
                    -3.8594593382759203e-04,
                    -3.8594593382759208e-04,
                    -3.8594593382759273e-04,
                ],
                [
                    +3.8594593382759165e-04,
                    -3.8594593382759111e-04,
                    +3.8594593382759083e-04,
                ],
                [
                    -3.8594593382759089e-04,
                    +3.8594593382759143e-04,
                    +3.8594593382759078e-04,
                ],
            ],
            dtype=torch.float64,
        ),
    },
}


extra: dict[str, Record] = {
    "SiH4_atom": {
        "es2": torch.tensor(5.0778974565885598e-004, dtype=torch.float64),
        "es3": torch.tensor(-2.9771152185276151e-005, dtype=torch.float64),
        "numbers": mols["SiH4"]["numbers"],
        "positions": mols["SiH4"]["positions"],
        "q": torch.tensor(
            [
                -8.4128253161907196e-02,
                +2.1032063290476799e-02,
                +2.1032063290476799e-02,
                +2.1032063290476799e-02,
                +2.1032063290476799e-02,
            ],
            dtype=torch.float64,
        ),
        "grad": torch.tensor(
            [
                [
                    -5.4210108624275222e-20,
                    -5.4210108624275222e-20,
                    -5.4210108624275222e-20,
                ],
                [
                    +4.0890639890707556e-05,
                    +4.0890639890707556e-05,
                    -4.0890639890707529e-05,
                ],
                [
                    -4.0890639890707529e-05,
                    -4.0890639890707529e-05,
                    -4.0890639890707529e-05,
                ],
                [
                    +4.0890639890707556e-05,
                    -4.0890639890707529e-05,
                    +4.0890639890707556e-05,
                ],
                [
                    -4.0890639890707529e-05,
                    +4.0890639890707556e-05,
                    +4.0890639890707556e-05,
                ],
            ],
            dtype=torch.float64,
        ),
    },
}


samples: dict[str, Record] = {**merge_nested_dicts(mols, refs), **extra}
